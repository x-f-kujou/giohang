<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Gá»­i Ä‘Æ¡n hÃ ng</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
<h3>â³ Äang gá»­i Ä‘Æ¡n hÃ ngâ€¦</h3>

<script>
const FORM_URL =
"https://docs.google.com/forms/d/e/1FAIpQLSc8Ts9qc4T-TRYX7my_6ryTBAis3bEU-yhrONjsZss1s15rIg/formResponse";

const ENTRY = {
  name: "entry.1313927642",
  phone: "entry.1798347891",
  address: "entry.428704529",
  products: "entry.131920185",
  total: "entry.1824592539"
};

const cart = JSON.parse(localStorage.getItem("cart") || "[]");
const customer = JSON.parse(localStorage.getItem("customer") || "{}");

if (!cart.length || !customer.name) {
  alert("Thiáº¿u thÃ´ng tin Ä‘Æ¡n hÃ ng");
  location.href = "index.html";
}

// ğŸ‘‰ FORMAT Sáº¢N PHáº¨M CHUáº¨N GOOGLE FORM
let productText = "";
let total = 0;

cart.forEach((p, i) => {
  productText += `${i + 1}. ${p.name} x${p.qty} = ${(p.price * p.qty).toLocaleString("vi-VN")} â‚«\n`;
  total += p.price * p.qty;
});

const params =
  ENTRY.name + "=" + encodeURIComponent(customer.name) +
  "&" + ENTRY.phone + "=" + encodeURIComponent(customer.phone) +
  "&" + ENTRY.address + "=" + encodeURIComponent(customer.address) +
  "&" + ENTRY.products + "=" + encodeURIComponent(productText) +
  "&" + ENTRY.total + "=" + encodeURIComponent(total.toLocaleString("vi-VN")) +
  "&submit=Submit";

// Gá»¬I FORM (KHÃ”NG Cáº¦N APPS SCRIPT)
fetch(FORM_URL, {
  method: "POST",
  mode: "no-cors",
  headers: {
    "Content-Type": "application/x-www-form-urlencoded"
  },
  body: params
});

// XÃ“A GIá» HÃ€NG
localStorage.removeItem("cart");

// CHUYá»‚N TRANG
setTimeout(() => {
  window.location.href = "thankyou.html";
}, 800);
</script>

</body>
</html>
