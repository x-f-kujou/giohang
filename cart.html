<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Giá» hÃ ng</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial; max-width: 900px; margin: auto; padding: 15px; background:#f5f5f5 }
    .item { display:flex; gap:12px; background:#fff; padding:10px; border-radius:10px; margin-bottom:10px }
    .item img { width:80px; height:80px; object-fit:cover; border-radius:8px }
    .qty button { width:28px; height:28px }
    .total { font-size:20px; font-weight:bold; text-align:right; margin:15px 0 }
    input,textarea,button { width:100%; padding:10px; margin-top:8px }
    .primary { background:#28a745; color:#fff; border:none }
    .danger { background:#dc3545; color:#fff; border:none }
  </style>
</head>

<body>

<h1>ğŸ›’ Giá» hÃ ng</h1>

<div id="cart"></div>
<div class="total" id="total"></div>

<div id="customer" style="display:none">
  <input id="name" placeholder="Há» tÃªn">
  <input id="phone" placeholder="Sá»‘ Ä‘iá»‡n thoáº¡i">
  <textarea id="address" placeholder="Äá»‹a chá»‰ giao hÃ ng"></textarea>

  <button class="primary" onclick="sendOrder()">ğŸ“© Gá»­i Ä‘Æ¡n</button>
  <button class="danger" onclick="clearCart()">ğŸ—‘ï¸ XÃ³a giá»</button>

  <hr>

  <h3>ğŸ’³ Thanh toÃ¡n chuyá»ƒn khoáº£n</h3>

  <img src="https://img.vietqr.io/image/VCB-1027122144-compact2.png"
       style="width:260px;display:block;margin:auto">

  <p style="text-align:center">
    Vietcombank<br>
    STK: <b>1027122144</b><br>
    TÃªn: <b>Tu Tu Phuong</b><br><br>
    Ná»™i dung CK:<br>
    <b id="ckContent"></b>
  </p>

  <button class="primary" onclick="confirmPaid()">âœ… TÃ´i Ä‘Ã£ chuyá»ƒn khoáº£n</button>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyFYt4umnHjXDJ_h0AeuZ6ILeyamc8yQMAUfArsOnZM7bR5KP-MHQwMthzlqUWCh8w/exec";
const ZALO_PHONE = "84358256608";

let cart = JSON.parse(localStorage.getItem("cart")) || [];
const cartDiv = document.getElementById("cart");
const totalDiv = document.getElementById("total");
const customerDiv = document.getElementById("customer");

function renderCart() {
  if (cart.length === 0) {
    cartDiv.innerHTML = "Giá» hÃ ng trá»‘ng";
    customerDiv.style.display = "none";
    return;
  }

  let total = 0;
  cartDiv.innerHTML = "";
  cart.forEach((p,i)=>{
    total += p.price*p.qty;
    cartDiv.innerHTML += `
      <div class="item">
        <img src="${p.image}">
        <div>
          <b>${p.name}</b><br>
          ${p.price.toLocaleString()} â‚« x ${p.qty}
        </div>
      </div>`;
  });

  totalDiv.innerText = "Tá»•ng: " + total.toLocaleString() + " â‚«";
  customerDiv.style.display = "block";
}

function sendOrder() {
  const name = nameEl.value = document.getElementById("name").value.trim();
  const phone = phoneEl.value = document.getElementById("phone").value.trim();
  const address = document.getElementById("address").value.trim();

  const total = cart.reduce((s,p)=>s+p.price*p.qty,0);
  const products = cart.map(p=>`${p.name} x${p.qty}`).join(" | ");

  fetch(`${SCRIPT_URL}?name=${name}&phone=${phone}&address=${address}&products=${products}&total=${total}`);
  updateCKContent();
  alert("âœ”ï¸ ÄÆ¡n Ä‘Ã£ táº¡o, vui lÃ²ng chuyá»ƒn khoáº£n");
}

function confirmPaid() {
  const phone = document.getElementById("phone").value;
  fetch(`${SCRIPT_URL}?action=confirm&phone=${phone}`);
  alert("âœ… ÄÃ£ xÃ¡c nháº­n thanh toÃ¡n");
  localStorage.removeItem("cart");
  location.reload();
}

function updateCKContent() {
  document.getElementById("ckContent").innerText = "CK " + document.getElementById("phone").value;
}

document.getElementById("phone").addEventListener("input", updateCKContent);

renderCart();
</script>

</body>
</html>
