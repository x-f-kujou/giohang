<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Gi·ªè h√†ng</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f6f6f6;
  margin: 0;
}
.container {
  max-width: 900px;
  margin: auto;
  background: #fff;
  padding: 20px;
}
.cart-item {
  display: flex;
  align-items: center;
  border-bottom: 1px solid #ddd;
  padding: 10px 0;
}
.cart-item img {
  width: 80px;
  margin-right: 15px;
}
.cart-item h4 {
  margin: 0;
}
.qty-btn {
  padding: 5px 10px;
  margin: 0 5px;
}
.total {
  font-size: 20px;
  text-align: right;
  margin-top: 15px;
  color: red;
}
input, textarea {
  width: 100%;
  padding: 10px;
  margin-bottom: 10px;
}
button {
  padding: 12px;
  width: 100%;
  background: #28a745;
  color: #fff;
  border: none;
  font-size: 16px;
  cursor: pointer;
}
.payment-box {
  margin: 10px 0;
}
.bank-info {
  display: none;
  border: 1px dashed #ccc;
  padding: 15px;
  margin-top: 10px;
  text-align: center;
}
.bank-info img {
  max-width: 220px;
}
</style>
</head>

<body>
<div class="container">
  <h2>üõí Gi·ªè h√†ng</h2>
  <div id="cart"></div>
  <div class="total" id="total"></div>

  <h3>üë§ Th√¥ng tin kh√°ch h√†ng</h3>
  <input id="name" placeholder="H·ªç t√™n">
  <input id="phone" placeholder="S·ªë ƒëi·ªán tho·∫°i">
  <textarea id="address" placeholder="ƒê·ªãa ch·ªâ"></textarea>

  <h3>üí≥ H√¨nh th·ª©c thanh to√°n</h3>
  <div class="payment-box">
    <label>
      <input type="radio" name="payment" value="COD" checked onclick="toggleBank(false)">
      COD
    </label><br>
    <label>
      <input type="radio" name="payment" value="CK" onclick="toggleBank(true)">
      Chuy·ªÉn kho·∫£n
    </label>
  </div>

  <!-- TH√îNG TIN CHUY·ªÇN KHO·∫¢N -->
  <div class="bank-info" id="bankInfo">
    <img src="https://i.imgur.com/6QJ6b3O.png" alt="QR CK"><br>
    <b>Vietcombank</b><br>
    STK: <b>1027122144</b><br>
    Ch·ªß TK: <b>T·ª´ T√∫ Ph∆∞∆°ng</b><br>
    <small>N·ªôi dung: T√™n + SƒêT</small>
  </div>

  <button onclick="sendOrder()">‚úÖ X√°c nh·∫≠n ƒë·∫∑t h√†ng</button>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzgI6E4onLA7FNA1VCGXnxOmjyllLGPT2uwdV6DbDJcMZrkn83pRDlugkNE5Gy6Bpvv/exec";

let cart = JSON.parse(localStorage.getItem("cart")) || [];

function renderCart() {
  const cartDiv = document.getElementById("cart");
  cartDiv.innerHTML = "";
  let total = 0;

  cart.forEach((p, i) => {
    total += p.price * p.qty;
    cartDiv.innerHTML += `
      <div class="cart-item">
        <img src="${p.image}">
        <div>
          <h4>${p.name}</h4>
          <p>${p.price.toLocaleString()} ƒë</p>
          <button class="qty-btn" onclick="changeQty(${i},-1)">-</button>
          ${p.qty}
          <button class="qty-btn" onclick="changeQty(${i},1)">+</button>
        </div>
      </div>`;
  });

  document.getElementById("total").innerText =
    "T·ªïng: " + total.toLocaleString() + " ƒë";
}

function changeQty(i, d) {
  cart[i].qty += d;
  if (cart[i].qty <= 0) cart.splice(i, 1);
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

function toggleBank(show) {
  document.getElementById("bankInfo").style.display = show ? "block" : "none";
}

function sendOrder() {
  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const address = document.getElementById("address").value.trim();
  const payment = document.querySelector("input[name=payment]:checked").value;

  if (!name || !phone || !address) {
    alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin");
    return;
  }

  if (cart.length === 0) {
    alert("Gi·ªè h√†ng tr·ªëng");
    return;
  }

  const total = cart.reduce((s,p)=>s+p.price*p.qty,0);
  const products = cart.map(p=>`${p.name} x${p.qty}`).join(" | ");
  const status = payment === "CK" ? "CH·ªú THANH TO√ÅN" : "CH∆ØA THANH TO√ÅN";

  const url =
    `${SCRIPT_URL}?name=${encodeURIComponent(name)}` +
    `&phone=${encodeURIComponent(phone)}` +
    `&address=${encodeURIComponent(address)}` +
    `&products=${encodeURIComponent(products)}` +
    `&total=${total}` +
    `&payment=${payment}` +
    `&status=${status}`;

  fetch(url)
    .then(r=>r.text())
    .then(t=>{
      if(t.trim()!=="OK"){
        alert("‚ùå G·ª≠i ƒë∆°n th·∫•t b·∫°i");
        return;
      }
      alert("‚úÖ ƒê√£ g·ª≠i ƒë∆°n th√†nh c√¥ng!\nVui l√≤ng ho√†n t·∫•t thanh to√°n n·∫øu chuy·ªÉn kho·∫£n.");

      // ‚ùó KH√îNG X√ìA GI·ªé H√ÄNG
      // localStorage.removeItem("cart");
    });
}

renderCart();
</script>
</body>
</html>
