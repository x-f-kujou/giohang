<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Gi·ªè h√†ng</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>üõí Gi·ªè h√†ng</h1>

<div id="cart" style="max-width:600px;margin:auto;"></div>
<h2 id="total" style="text-align:center"></h2>

<div style="max-width:400px;margin:20px auto;">
  <input id="name" placeholder="T√™n kh√°ch h√†ng" style="width:100%;padding:10px;margin-bottom:10px">
  <input id="phone" placeholder="S·ªë ƒëi·ªán tho·∫°i" style="width:100%;padding:10px;margin-bottom:10px">
  <button id="submit" class="buy-btn">X√°c nh·∫≠n ƒë∆°n</button>
</div>

<script>
const SCRIPT_URL = "LINK_GOOGLE_APPS_SCRIPT_C·ª¶A_B·∫†N";

function getCart() {
  return JSON.parse(localStorage.getItem("cart")) || [];
}

function saveCart(cart) {
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

function renderCart() {
  const cart = getCart();
  const box = document.getElementById("cart");
  let total = 0;

  if (cart.length === 0) {
    box.innerHTML = "<p>Gi·ªè h√†ng tr·ªëng</p>";
    return;
  }

  box.innerHTML = "";
  cart.forEach((p, i) => {
    total += p.price * p.qty;

    box.innerHTML += `
      <div class="product" style="margin-bottom:10px">
        <h3>${p.name}</h3>
        <p>${p.price.toLocaleString("vi-VN")} ‚Ç´ √ó ${p.qty}</p>

        <button onclick="updateQty(${i},1)">+</button>
        <button onclick="updateQty(${i},-1)">‚àí</button>
        <button onclick="removeItem(${i})">Xo√°</button>
      </div>
    `;
  });

  document.getElementById("total").innerText =
    "T·ªïng ti·ªÅn: " + total.toLocaleString("vi-VN") + " ‚Ç´";
}

function updateQty(i, d) {
  const cart = getCart();
  cart[i].qty += d;
  if (cart[i].qty <= 0) cart.splice(i, 1);
  saveCart(cart);
}

function removeItem(i) {
  const cart = getCart();
  cart.splice(i, 1);
  saveCart(cart);
}

renderCart();

document.getElementById("submit").onclick = () => {
  const order = {
    name: name.value,
    phone: phone.value,
    items: getCart(),
    time: new Date().toLocaleString("vi-VN")
  };

  fetch(SCRIPT_URL, {
    method: "POST",
    mode: "no-cors",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(order)
  });

  localStorage.removeItem("cart");

  setTimeout(() => {
    window.location.href = "thankyou.html";
  }, 800);
};
</script>

</body>
</html>
