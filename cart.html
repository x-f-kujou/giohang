<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Gi·ªè h√†ng</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;max-width:900px;margin:auto;padding:15px;background:#f5f5f5}
h1{text-align:center}
.item{display:flex;gap:12px;background:#fff;border-radius:10px;padding:10px;margin-bottom:10px}
.item img{width:80px;height:80px;border-radius:8px;object-fit:cover}
.item-info{flex:1}
.qty button{width:28px;height:28px;border:none;border-radius:6px;background:#007bff;color:#fff}
.qty span{margin:0 8px;font-weight:bold}
.total{font-size:20px;font-weight:bold;text-align:right;margin:15px 0}
input,textarea{width:100%;padding:8px;margin-top:8px;border-radius:6px;border:1px solid #ccc}
button{width:100%;padding:12px;margin-top:10px;border:none;border-radius:8px;font-size:16px}
.primary{background:#28a745;color:#fff}
.danger{background:#dc3545;color:#fff}
.empty{text-align:center;background:#fff;padding:20px;border-radius:10px}
label{display:block;margin-top:6px}
</style>
</head>

<body>

<h1>üõí Gi·ªè h√†ng</h1>

<div id="cart"></div>
<div class="total" id="total"></div>

<div id="customer" style="display:none">
  <h3>üë§ Th√¥ng tin kh√°ch h√†ng</h3>
  <input id="name" placeholder="H·ªç t√™n">
  <input id="phone" placeholder="S·ªë ƒëi·ªán tho·∫°i">
  <textarea id="address" placeholder="ƒê·ªãa ch·ªâ giao h√†ng"></textarea>

  <h3>üí≥ H√¨nh th·ª©c thanh to√°n</h3>
  <label><input type="radio" name="payment" value="COD" checked> COD</label>
  <label><input type="radio" name="payment" value="CK"> Chuy·ªÉn kho·∫£n</label>

  <div id="bank" style="display:none;text-align:center;margin-top:10px">
    <img src="https://raw.githubusercontent.com/x-f-kujou/Image-host/main/Vietcombank%2050c407c7-4210-46a6-943d-7e73ed23ac88.jpg" width="260">
    <p><b>Vietcombank</b><br>STK: 1027122144<br>Tu Tu Phuong</p>
  </div>

  <button class="primary" onclick="sendOrder()">üì© X√°c nh·∫≠n ƒë·∫∑t h√†ng</button>
  <button class="danger" onclick="clearCart()">üóëÔ∏è X√≥a gi·ªè h√†ng</button>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx1KyYNwO4pSJyUdQ1pjnf9SUDkCqSmk13bh45PApkmoMKCaeYaEWr2b62uTFQ43HLv/exec";
const ZALO_PHONE = "84358256608";

let cart = JSON.parse(localStorage.getItem("cart")) || [];
const cartDiv = document.getElementById("cart");
const totalDiv = document.getElementById("total");
const customerDiv = document.getElementById("customer");

function money(n){return n.toLocaleString("vi-VN")+" ‚Ç´"}

document.querySelectorAll("input[name=payment]").forEach(r=>{
  r.addEventListener("change",()=>{
    const val=document.querySelector("input[name=payment]:checked").value;
    document.getElementById("bank").style.display=val==="CK"?"block":"none";
  });
});

function renderCart(){
  if(!cart.length){
    cartDiv.innerHTML=`<div class="empty">Gi·ªè h√†ng tr·ªëng</div>`;
    totalDiv.innerHTML="";
    customerDiv.style.display="none";
    return;
  }
  let total=0;
  cartDiv.innerHTML="";
  cart.forEach((p,i)=>{
    total+=p.price*p.qty;
    cartDiv.innerHTML+=`
    <div class="item">
      <img src="${p.image}">
      <div class="item-info">
        <b>${p.name}</b><br>${money(p.price)}
        <div class="qty">
          <button onclick="changeQty(${i},-1)">-</button>
          <span>${p.qty}</span>
          <button onclick="changeQty(${i},1)">+</button>
        </div>
      </div>
    </div>`;
  });
  totalDiv.innerText="T·ªïng: "+money(total);
  customerDiv.style.display="block";
}

function changeQty(i,d){
  cart[i].qty+=d;
  if(cart[i].qty<=0) cart.splice(i,1);
  localStorage.setItem("cart",JSON.stringify(cart));
  renderCart();
}

function clearCart(){
  if(confirm("X√≥a gi·ªè h√†ng?")){
    localStorage.removeItem("cart");
    cart=[];
    renderCart();
  }
}

async function sendOrder(){
  const name=nameEl?.value||document.getElementById("name").value.trim();
  const phone=document.getElementById("phone").value.trim();
  const address=document.getElementById("address").value.trim();
  const payment=document.querySelector("input[name=payment]:checked").value;

  if(!name||!phone||!address){alert("Nh·∫≠p ƒë·ªß th√¥ng tin");return;}

  const total=cart.reduce((s,p)=>s+p.price*p.qty,0);
  const products=cart.map(p=>`${p.name} x${p.qty}`).join(" | ");
  const status=payment==="CK"?"CH·ªú THANH TO√ÅN":"CH∆ØA THANH TO√ÅN";

  await fetch(`${SCRIPT_URL}?name=${encodeURIComponent(name)}&phone=${phone}&address=${encodeURIComponent(address)}&products=${encodeURIComponent(products)}&total=${total}&payment=${payment}&status=${status}`);

  let msg=`üõí ƒê∆†N H√ÄNG\nüë§ ${name}\nüìû ${phone}\nüè† ${address}\nüí≥ ${payment}\n\n`;
  cart.forEach(p=>msg+=`- ${p.name} x${p.qty}\n`);
  msg+=`\nT·ªîNG: ${money(total)}`;

  window.open(`https://zalo.me/${ZALO_PHONE}?text=${encodeURIComponent(msg)}`,"_blank");

  localStorage.removeItem("cart");
  alert("‚úÖ ƒê·∫∑t h√†ng th√†nh c√¥ng!");
  location.reload();
}

renderCart();
</script>

</body>
</html>
